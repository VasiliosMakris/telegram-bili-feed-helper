edition: 1.0.0
name: telegram-bili-feed-helper-serverless
access: "default"

vars:
  region: "eu-central-1"
  service:
    name: "telegram-bili-feed-helper-serverless"
    description: 'telegram-bili-feed-helper-serverless'

services:
  framework:
    component: fc
    actions:
      pre-deploy:
        - run: pip3 install -r requirements.txt -t .
          path: ./
    props:
      region: ${vars.region}
      service: ${vars.service}
      function:
        name: "serverless"
        description: 'telegram-bili-feed-helper-serverless'
        codeUri: './'
        runtime: custom
        timeout: 60
        instanceConcurrency: 40
        environmentVariables:
          TOKEN: ${env(TOKEN)}
          DOMAIN: ${env(DOMAIN)}
          PORT: ${env(PORT)}
          DATABASE_URL: ${env(DATABASE_URL)}
          BILI_API: ${env(BILI_API)}
        customRuntimeConfig:
          command:
            - python
          args:
            - main.py
      triggers:
        - name: httpTrigger
          type: http
          config:
            authType: anonymous
            methods:
              - GET
              - POST